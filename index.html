<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDKBIUOu1AT_ONnWl3kIevex58O09R...", // Apna config wapas daalein
        authDomain: "codes-93f34.firebaseapp.com",
        databaseURL: "https://codes-93f34-default-rtdb.firebaseio.com",
        projectId: "codes-93f34",
        storageBucket: "codes-93f34.firebasestorage.app",
        messagingSenderId: "874409654851",
        appId: "1:874409654851:web:0c899ff23fe696..."
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const grid = document.getElementById('main-grid');

    // Display Data
    onValue(ref(db, 'qr_gallery'), (snapshot) => {
        grid.innerHTML = "";
        const data = snapshot.val();
        if(data) {
            Object.keys(data).reverse().forEach(key => {
                const item = data[key];
                const card = document.createElement('div');
                card.className = 'qr-card';
                card.innerHTML = `
                    <div class="qr-frame">
                        <img src="${item.url}" class="qr-img" id="img-${key}">
                    </div>
                    <div class="qr-name">${item.name}</div>
                    <a href="https://instagram.com/WISHES___ll" target="_blank" class="btn follow-btn" onclick="unlockItem('${key}')">Follow to See</a>
                    <button class="btn dl-btn" id="dl-${key}" onclick="downloadItem('${item.url}')">Download</button>
                `;
                grid.appendChild(card);
            });
        }
    });

    // IS BAAR HUM FILE KO DATA-URL MEIN BADAL RAHE HAIN (No Storage Needed)
    document.getElementById('up-btn').onclick = async () => {
        const file = document.getElementById('file-in').files[0];
        const name = document.getElementById('name-in').value;
        
        if(!file || !name) return alert("Fill Name and Photo!");

        const reader = new FileReader();
        reader.readAsDataURL(file); // Photo ko text code mein badalna
        reader.onload = async () => {
            const base64Image = reader.result;
            const newRef = push(ref(db, 'qr_gallery'));
            await set(newRef, { name: name, url: base64Image });
            alert("Success! Photo saved in Database.");
            location.reload();
        };
    };

    // ... (Unlock aur Download function pehle jaise hi rahenge) ...
</script>
