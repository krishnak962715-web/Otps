<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WISHES - Follow to Unlock</title>
    <style>
        :root { --insta: #E1306C; --green: #28a745; }
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f8f9fa; margin: 0; padding: 20px; }
        .card { max-width: 380px; margin: auto; background: #fff; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1#admin-trigger { font-size: 2.5rem; margin: 0; cursor: pointer; user-select: none; }
        #display-name { font-size: 1.2rem; color: #666; margin: 10px 0 20px; }
        .qr-frame { width: 220px; height: 220px; margin: 0 auto 20px; border: 2px solid #eee; border-radius: 15px; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        #qr-img { width: 100%; height: 100%; object-fit: cover; filter: blur(15px); transition: 0.5s; display: none; }
        #qr-img.unlocked { filter: blur(0); display: block; }
        .lock-text { position: absolute; font-weight: bold; color: #999; }
        .btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; text-decoration: none; transition: 0.3s; }
        .follow-btn { background: var(--insta); color: white; }
        .dl-btn { background: #ccc; color: #777; pointer-events: none; }
        .dl-btn.active { background: var(--green); color: white; pointer-events: auto; }
        #admin-panel { display: none; margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="card">
    <h1 id="admin-trigger">WISHES</h1>
    <div id="display-name">Loading...</div>

    <div class="qr-frame">
        <div class="lock-text" id="lock-msg">Follow to Unlock QR</div>
        <img id="qr-img" src="" alt="QR">
    </div>

    <a href="https://instagram.com/YOUR_USERNAME" id="insta-btn" target="_blank" class="btn follow-btn">Follow on Instagram</a>
    <button id="dl-btn" class="btn dl-btn">Download QR</button>

    <div id="admin-panel">
        <input type="text" id="name-in" placeholder="Enter Name">
        <input type="file" id="file-in" accept="image/*">
        <button class="btn" style="background:#333; color:white;" id="up-btn">Upload & Save</button>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

  // Aapka asli config aapki screenshots se
  const firebaseConfig = {
    apiKey: "AIzaSyDKBIUOu1AT_ONnWl3kIevex58O09R...", // Maine aapki screen se li hai
    authDomain: "codes-93f34.firebaseapp.com",
    databaseURL: "https://codes-93f34-default-rtdb.firebaseio.com",
    projectId: "codes-93f34",
    storageBucket: "codes-93f34.firebasestorage.app",
    messagingSenderId: "874409654851",
    appId: "1:874409654851:web:0c899ff23fe696..."
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);

  const qrImg = document.getElementById('qr-img');
  const nameDisplay = document.getElementById('display-name');
  const dlBtn = document.getElementById('dl-btn');
  const lockMsg = document.getElementById('lock-msg');

  // 1. Data load karna
  onValue(ref(db, 'content'), (snap) => {
    const data = snap.val();
    if(data) {
        nameDisplay.innerText = data.name;
        qrImg.src = data.url;
    }
  });

  // 2. Admin Logic (10 clicks + 1529 PIN)
  let clicks = 0;
  document.getElementById('admin-trigger').onclick = () => {
    clicks++;
    if(clicks === 10) {
        if(prompt("Enter PIN:") === "1529") document.getElementById('admin-panel').style.display = 'block';
        clicks = 0;
    }
  };

  // 3. Unlock Logic
  document.getElementById('insta-btn').onclick = () => {
    setTimeout(() => {
        qrImg.style.display = 'block';
        qrImg.classList.add('unlocked');
        lockMsg.style.display = 'none';
        dlBtn.classList.add('active');
    }, 4000); 
  };

  // 4. Download Logic
  dlBtn.onclick = async () => {
    const res = await fetch(qrImg.src);
    const blob = await res.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'QR_Wishes.png';
    a.click();
  };

  // 5. Upload Function
  document.getElementById('up-btn').onclick = async () => {
    const file = document.getElementById('file-in').files[0];
    const name = document.getElementById('name-in').value;
    if(!file || !name) return alert("Fill all details!");

    const imgRef = sRef(storage, 'qr_image');
    await uploadBytes(imgRef, file);
    const url = await getDownloadURL(imgRef);

    await set(ref(db, 'content'), { name, url });
    alert("Updated Successfully!");
    location.reload();
  };
</script>

</body>
</html>
