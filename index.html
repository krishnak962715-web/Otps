<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WISHES - QR Collection</title>
    <style>
        :root { --insta: #E1306C; --green: #28a745; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding: 10px; }
        h1#admin-trigger { text-align: center; font-size: 2.2rem; cursor: pointer; margin: 15px 0; color: #333; }
        
        /* 2 QR in one line */
        .qr-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px; 
            max-width: 600px; 
            margin: auto; 
        }

        .qr-card { 
            background: #fff; 
            padding: 8px; 
            border-radius: 12px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.08); 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .qr-frame { 
            width: 100%; 
            aspect-ratio: 1/1; 
            background: #eee; 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
            overflow: hidden; 
        }

        .qr-img { width: 100%; height: 100%; object-fit: contain; filter: blur(20px); display: none; }
        .qr-img.unlocked { filter: blur(0); display: block; }
        .lock-icon { position: absolute; font-size: 1.2rem; opacity: 0.5; }

        /* Naam QR ke theek niche */
        .qr-name { 
            margin-top: 8px; 
            font-weight: bold; 
            font-size: 0.95rem; 
            color: #222; 
            text-align: center;
            width: 100%;
        }

        .btn { display: block; width: 100%; padding: 8px 0; margin-top: 6px; border: none; border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer; text-decoration: none; text-align: center; }
        .follow-btn { background: var(--insta); color: white; }
        .dl-btn { background: #ddd; color: #888; pointer-events: none; }
        .dl-btn.active { background: var(--green); color: white; pointer-events: auto; }

        #admin-panel { display: none; max-width: 320px; margin: 15px auto; background: #fff; padding: 15px; border-radius: 12px; border: 2px solid #000; }
        input { width: 100%; padding: 10px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
    </style>
</head>
<body>

    <h1 id="admin-trigger">WISHES</h1>

    <div id="admin-panel">
        <h4 style="margin:0 0 10px">Admin: Add New QR</h4>
        <input type="text" id="name-in" placeholder="Wish Ka Naam Likho">
        <input type="file" id="file-in" accept="image/*">
        <button class="btn" style="background:#000; color:#fff" id="up-btn">Save QR & Name</button>
    </div>

    <div class="qr-grid" id="main-grid">
        </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

    // Your Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyDKBIUOu1AT_ONnWl3kIevex58O09R...", // Apna asli key daalein
        authDomain: "codes-93f34.firebaseapp.com",
        databaseURL: "https://codes-93f34-default-rtdb.firebaseio.com",
        projectId: "codes-93f34",
        storageBucket: "codes-93f34.firebasestorage.app",
        messagingSenderId: "874409654851",
        appId: "1:874409654851:web:0c899ff23fe696..."
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);
    const grid = document.getElementById('main-grid');

    onValue(ref(db, 'qr_gallery'), (snapshot) => {
        grid.innerHTML = "";
        const data = snapshot.val();
        if(data) {
            Object.keys(data).reverse().forEach(key => {
                const item = data[key];
                const card = document.createElement('div');
                card.className = 'qr-card';
                card.innerHTML = `
                    <div class="qr-frame">
                        <span class="lock-icon" id="lock-${key}">ðŸ”’</span>
                        <img src="${item.url}" class="qr-img" id="img-${key}">
                    </div>
                    <div class="qr-name">${item.name}</div>
                    <a href="https://instagram.com/WISHES___ll" target="_blank" class="btn follow-btn" onclick="unlockItem('${key}')">Follow to Unlock</a>
                    <button class="btn dl-btn" id="dl-${key}" onclick="downloadItem('${item.url}')">Download</button>
                `;
                grid.appendChild(card);
            });
        }
    });

    window.unlockItem = (id) => {
        setTimeout(() => {
            document.getElementById(`img-${id}`).classList.add('unlocked');
            document.getElementById(`lock-${id}`).style.display = 'none';
            document.getElementById(`dl-${id}`).classList.add('active');
        }, 4000);
    };

    window.downloadItem = async (url) => {
        const res = await fetch(url);
        const blob = await res.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'Wishes_QR.png';
        a.click();
    };

    let clicks = 0;
    document.getElementById('admin-trigger').onclick = () => {
        clicks++;
        if(clicks === 10) {
            if(prompt("Enter PIN:") === "1529") document.getElementById('admin-panel').style.display = 'block';
            clicks = 0;
        }
    };

    document.getElementById('up-btn').onclick = async () => {
        const file = document.getElementById('file-in').files[0];
        const name = document.getElementById('name-in').value;
        if(!file || !name) return alert("Pehle Name aur Image select karo!");

        const btn = document.getElementById('up-btn');
        btn.innerText = "Saving...";
        btn.disabled = true;

        const imgRef = sRef(storage, 'gallery/' + Date.now());
        await uploadBytes(imgRef, file);
        const url = await getDownloadURL(imgRef);

        const newRef = push(ref(db, 'qr_gallery'));
        await set(newRef, { name: name, url: url });

        alert("Zabardast! Naya QR add ho gaya.");
        location.reload();
    };
</script>
</body>
</html>
